# Запуск: бот присылает песню в ответ на заявку

Один контур: **Mini App → бот (Supabase) → воркер (астро → DeepSeek → Suno) → бот присылает аудио**.

Подробно: **docs/ЗАПУСК_ПОЛНОГО_ПАЙПЛАЙНА.md**.

---

## На этом компьютере

### 1. Настройка (один раз)

```bash
cd bot
npm install
cp .env.example .env
# Заполни .env: BOT_TOKEN, SUPABASE_URL, SUPABASE_SERVICE_KEY, DEEPSEEK_API_KEY, SUNO_API_KEY
npm run check-env
```

Миграции Supabase и промпт в БД: см. docs/КАК_ВЫПОЛНИТЬ_МИГРАЦИЮ.md и `npm run seed-ideally-tuned`.

### 2. Запуск бота (терминал 1)

```bash
cd bot
npm start
```

Бот принимает заявки из Mini App (sendData или POST /submit-request), пишет их в Supabase.

### 3. Запуск воркера (терминал 2)

```bash
cd bot
npm run worker:start
```

Раз в 60 секунд воркер берёт одну заявку pending → астро → DeepSeek → Suno → отправляет аудио пользователю в Telegram.

Для фона (каждые 5 минут): `npm run worker:loop`.

### 4. Mini App

В **index.html** задай `window.HEROES_API_BASE = 'https://...'` на URL бота (если бот на Render/Vercel — подставь его домен). Либо используй только sendData — тогда заявка уходит боту напрямую через Telegram.

---

После этого: заявка из приложения → бот сохраняет → воркер обрабатывает → пользователь получает песню в чате с ботом.
