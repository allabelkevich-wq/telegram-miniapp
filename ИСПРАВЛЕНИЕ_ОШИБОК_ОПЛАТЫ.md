# Исправление ошибок оплаты и ссылок

## Проблемы и их решения

### 1. Ошибка 404 DEPLOYMENT_NOT_FOUND при оплате

**Причина:** Не настроены переменные окружения для HOT API в Render.

**Решение:**
1. Зайти в Render Dashboard → yupsoul-bot → Environment
2. Добавить недостающие переменные:

```
HOT_WEBHOOK_SECRET=<получить_в_HOT_Pay>
HOT_ITEM_ID_DEFAULT=<создать_в_HOT_Pay>
RENDER_EXTERNAL_URL=https://telegram-miniapp-ar09.onrender.com
```

3. Перезапустить сервис в Render

### 2. Ссылка на мини-приложение не работает

**Причина:** Неверная или устаревшая ссылка в кнопке меню бота.

**Решение:** ✅ **ИСПРАВЛЕНО**
- Mini App раздаётся с Render (тот же сервер, что и бот)
- URL берётся из Render: `https://<твой-сервис>.onrender.com`
- См. `ССЫЛКА_ДЛЯ_КНОПКИ_БОТА.txt` — полная инструкция

### 3. Синхронизация файлов

**Решение:** ✅ **ИСПРАВЛЕНО**
- Скопированы улучшения из `bot/public/index.html` в `public/index.html`
- Добавлен `.nojekyll` в папку `public/` для GitHub Pages

## Настройка HOT Pay (пошагово)

### Шаг 1: Создать платёжную ссылку в HOT Pay
1. Зайти на [pay.hot-labs.org](https://pay.hot-labs.org)
2. New link → заполнить:
   - Link Name: "YupSoul Payment"
   - Description: "Оплата генерации звукового ключа"
   - Product Price: оставить пустым (динамическая цена)
   - Payment Token: USDT (или другой токен)
   - Redirect Domain: домен твоего Render (напр. `yupsoul-bot.onrender.com` без https://)
   - Webhook URL: `https://<твой-сервис>.onrender.com/api/payments/hot/webhook`

### Шаг 2: Получить данные для Render
1. Скопировать **item_id** созданной ссылки
2. Получить **webhook secret** в разделе Developer

### Шаг 3: Добавить в Render Environment
```
HOT_WEBHOOK_SECRET=<webhook_secret_из_HOT>
HOT_ITEM_ID_DEFAULT=<item_id_из_HOT>
RENDER_EXTERNAL_URL=https://<твой-сервис>.onrender.com
```
(Render задаёт RENDER_EXTERNAL_URL автоматически — проверь в Dashboard)

### Шаг 4: Перезапустить сервисы
1. Render → yupsoul-bot → Manual Deploy
2. Render → yupsoul-worker → Manual Deploy

## Проверка работоспособности

1. **Мини-приложение:** Открыть ссылку `https://<твой-сервис>.onrender.com` или проверить `/api/miniapp-url`
2. **Оплата:** Заполнить форму → К оплате → должен открыться HOT Checkout
3. **Логи:** Проверить логи в Render на наличие ошибок

## Статус исправлений

- ✅ Синхронизированы HTML файлы
- ✅ Исправлена ссылка на мини-приложение  
- ✅ API URL в приложении динамический (window.location.origin) — работает при любом домене
- ✅ Обновлена документация по переменным окружения
- ⏳ Требуется настройка HOT Pay в админке
- ⏳ Требуется добавление переменных в Render

## Следующие шаги

1. Настроить HOT Pay согласно инструкции выше
2. Добавить переменные в Render Environment
3. Перезапустить сервисы
4. Протестировать полный цикл оплаты