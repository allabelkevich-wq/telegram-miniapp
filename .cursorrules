# YupSoul — правила проекта

- **Git:** только ветка `main`. Все коммиты и push — в main. Деплой (Render, GitHub Pages) идёт только из main. См. `docs/GIT_WORKFLOW.md`.
- **Одна ветка — обновы катятся везде:** правки в main автоматически попадают во все нужные папки через build (render.yaml копирует public/ → bot/public/). Не создавать другие ветки для «отдельных версий». Не копировать вручную между папками — только через деплой.
- **Перед началом работы:** в начале сессии или перед крупными задачами/деплоем выполнить `git pull origin main`, чтобы локальный main был актуальным. Иначе агент может создать ветку от устаревшего main.
- Контекст и цели проекта описаны в **PROJECT_BRIEF.md** — учитывай их при любых доработках.
- **Mini App (один источник правды):** правки интерфейса — только в **public/index.html**. Иконки и ассеты — только в **public/assets/**. Render при сборке копирует `public/` в `bot/public/` (render.yaml). Не редактировать `bot/public/index.html` напрямую.
- **Чтобы обновы попали в деплой с первого раза:** после любых правок `public/index.html` или `public/assets/` обязательно выполнить синхронизацию и отправить в main:
  1. Либо один раз: `./scripts/sync-and-deploy-miniapp.sh "краткое описание правок"` (копирует в bot/public/, коммит, push).
  2. Либо вручную: `cp public/index.html bot/public/ && cp -r public/assets/icons bot/public/assets/ 2>/dev/null; git add public/index.html bot/public/index.html && git commit -m "..." && git push origin main`.
  Pre-commit хук при коммите изменённого public/index.html автоматически подмешивает копию в bot/public/ и добавляет в коммит — расхождений в репо не будет.
- Язык ответов и комментариев в коде: русский по умолчанию (если пользователь не попросит иначе).
- Стек: Telegram Mini App (HTML/JS), Telegram Bot API, в перспективе — оплата Stars, админ-панель заявок, выдача файлов через бота.
- **Автодеплой:** после правок Mini App всегда делать commit + push в main (через скрипт или вручную). Иначе на Render при сборке попадёт старая версия из git — обновы в боте не появятся.

---

## Защита от путаницы (договорённость)

**Цель:** никаких дубликатов, откатов к старым версиям и потери труда.

- **Один источник правды на артефакт.** Не создавать копии файлов «на всякий случай». Если нужна копия — явно в `_archive/` с датой.
- **Перед созданием нового файла:** проверить, нет ли уже канонической версии (например, код бота — только в `bot/`, не в корне).
- **Перед удалением или объединением:** убедиться, что уникальное содержимое сохранено. При сомнении — оставить как есть или сначала скопировать в `_archive/`.
- **Перед правками в «похожем» файле:** уточнить у пользователя или проверить по правилам — это тот файл, который нужно редактировать?
- **Карта канонических файлов:**
  - Mini App UI: `public/index.html`
  - Воркер генерации: `bot/workerSoundKey.js` (не создавать в корне)
  - Бот, API: `bot/index.js`
  - Конфиг деплоя: `render.yaml`
