# YupSoul Bot

Telegram-–±–æ—Ç –¥–ª—è –ø—Ä–∏—ë–º–∞ –∑–∞—è–≤–æ–∫ –∏–∑ Mini App –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

- **`/start`** ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª (Mini App).
- **–î–∞–Ω–Ω—ã–µ –∏–∑ Mini App** ‚Äî –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª ‚Üí ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –≤–æ –í—Å–µ–ª–µ–Ω–Ω—É—é¬ª –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –±–æ—Ç—É. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞—è–≤–∫—É –∏ –æ—Ç–≤–µ—á–∞–µ—Ç: ¬´–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!¬ª.
- **`/get_analysis`** ‚Äî –∑–∞–ø—Ä–æ—Å –¥–µ—Ç–∞–ª—å–Ω–æ–π —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –Ω–∞—Ç–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç—ã (–¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã; —Ñ—Ä–∞–∑—ã ¬´—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞¬ª, ¬´–ø–æ–ª—É—á–∏—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É¬ª —Ç–æ–∂–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç).
- **`/admin`** ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤: —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞—è–≤–æ–∫ –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–µ–±-–∞–¥–º–∏–Ω–∫—É (`/admin-simple`). –ü–æ–¥—Ä–æ–±–Ω–æ: [–ù–ê–°–¢–†–û–ô–ö–ê_–ê–î–ú–ò–ù–ê.md](./–ù–ê–°–¢–†–û–ô–ö–ê_–ê–î–ú–ò–ù–ê.md). –ê–¥–º–∏–Ω–∫—É —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –∏–∑ Mini App (–∫–Ω–æ–ø–∫–∞ ¬´üëë –ê–¥–º–∏–Ω–∫–∞¬ª –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —É –∞–¥–º–∏–Ω–æ–≤) –∏ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–æ—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

**–ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å –Ω—É–ª—è:** [docs/–ü–û–®–ê–ì–û–í–ê–Ø_–ù–ê–°–¢–†–û–ô–ö–ê.md](../docs/–ü–û–®–ê–ì–û–í–ê–Ø_–ù–ê–°–¢–†–û–ô–ö–ê.md) ‚Äî –∫—É–¥–∞ –∑–∞–π—Ç–∏, —á—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –∫—É–¥–∞ –≤—Å—Ç–∞–≤–∏—Ç—å.  
**–ß–µ–∫–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è:** [docs/–ß–ï–ö–õ–ò–°–¢_–î–ï–ü–õ–û–ô_–ò_–î–ê–õ–¨–®–ï.md](../docs/–ß–ï–ö–õ–ò–°–¢_–î–ï–ü–õ–û–ô_–ò_–î–ê–õ–¨–®–ï.md).

## –ó–∞–ø—É—Å–∫

1. –°–æ–∑–¥–∞–π –±–æ—Ç–∞ –≤ [@BotFather](https://t.me/BotFather), —Å–∫–æ–ø–∏—Ä—É–π —Ç–æ–∫–µ–Ω.
2. –í –ø–∞–ø–∫–µ `bot/` —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env`:
   ```env
   BOT_TOKEN=—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
   MINI_APP_URL=https://telegram-miniapp-ar09.onrender.com/app
   ADMIN_TELEGRAM_IDS=—Ç–≤–æ–π_telegram_id
   ```
   **–ö–∞–∫ —É–∑–Ω–∞—Ç—å —Å–≤–æ–π Telegram ID:** –Ω–∞–ø–∏—à–∏ –≤ Telegram –±–æ—Ç—É [@userinfobot](https://t.me/userinfobot) ‚Äî –æ–Ω –ø—Ä–∏—à–ª—ë—Ç —Ç–≤–æ–π ID (—á–∏—Å–ª–æ). –í—Å—Ç–∞–≤—å –µ–≥–æ –≤ `ADMIN_TELEGRAM_IDS`. –ù–µ—Å–∫–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: `123456,789012`.
   (–ú–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ `.env.example`.)
3. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏:
   ```bash
   cd bot
   npm install
   npm start
   ```
4. –í [@BotFather](https://t.me/BotFather) ‚Üí —Ç–≤–æ–π –±–æ—Ç ‚Üí Bot Settings ‚Üí Menu Button ‚Üí —É–∫–∞–∂–∏ URL Mini App (—Ç–æ—Ç –∂–µ `MINI_APP_URL`), —á—Ç–æ–±—ã –ø–æ–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ –±—ã–ª–∞ –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª.

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∫–∏

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –º–µ–Ω—é (–∏–ª–∏ `/start` –∏ –∫–Ω–æ–ø–∫—É) ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è Mini App.
2. –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É, –ø–µ—Ä–µ–π–¥–∏ –Ω–∞ ¬´–û–ø–ª–∞—Ç–∞¬ª, –Ω–∞–∂–º–∏ ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª.
3. –í–Ω–∏–∑—É –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –≤–æ –í—Å–µ–ª–µ–Ω–Ω—É—é¬ª. –ù–∞–∂–º–∏ –µ—ë ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä–æ–µ—Ç—Å—è, –≤ —á–∞—Ç–µ –ø—Ä–∏–¥—ë—Ç –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ ¬´–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!¬ª.
4. –í –∫–æ–Ω—Å–æ–ª–∏, –≥–¥–µ –∑–∞–ø—É—â–µ–Ω –±–æ—Ç, –ø–æ—è–≤–∏—Ç—Å—è –ª–æ–≥ –∑–∞—è–≤–∫–∏.

## Supabase (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∑–∞—è–≤–∫–∏ –≤ –ë–î:

1. –°–æ–∑–¥–∞–π –ø—Ä–æ–µ–∫—Ç –≤ [Supabase](https://supabase.com), –æ—Ç–∫—Ä–æ–π SQL Editor.
2. –í—ã–ø–æ–ª–Ω–∏ —Å–∫—Ä–∏–ø—Ç –∏–∑ `bot/supabase-schema.sql` (—Ç–∞–±–ª–∏—Ü—ã `track_requests`, `astro_snapshots` –∏ –ø—Ä–∏–≤—è–∑–∫–∞).
3. –í Settings ‚Üí API —Å–∫–æ–ø–∏—Ä—É–π **Project URL** –∏ **service_role** key (–Ω–µ anon).
4. –î–æ–±–∞–≤—å –≤ `.env`:
   ```env
   SUPABASE_URL=https://xxx.supabase.co
   SUPABASE_SERVICE_KEY=eyJ...
   ```
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –∑–∞—è–≤–∫–∏ –±—É–¥—É—Ç –ø–∏—Å–∞—Ç—å—Å—è –≤ Supabase. –ë–µ–∑ —ç—Ç–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–∫–∏ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å.

## –ê—Å—Ç—Ä–æ–º–æ–¥—É–ª—å (–≠—Ç–∞–ø 2)

- **astroLib.js** ‚Äî –≤–µ–¥–∏—á–µ—Å–∫–∏–π/—Å–∏–¥–µ—Ä–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ ¬´–ú–û–Ø –î–£–®–ê¬ª: –∑–æ–¥–∏–∞–∫ Lahiri, –¥–æ–º–∞ **Whole Sign**; –Ω–∞–∫—à–∞—Ç—Ä—ã/–ø–∞–¥—ã (–±–æ–∂–µ—Å—Ç–≤–∞, –î—Ö–∞—Ä–º–∞/–ê—Ä—Ç—Ö–∞/–ö–∞–º–∞/–ú–æ–∫—à–∞), –∞—Å–ø–µ–∫—Ç—ã (–≤ —Ç.—á. –∫–≤–∏–Ω—Ç–∏–ª—å, –±–∏–∫–≤–∏–Ω—Ç–∏–ª—å, –º–∏–Ω–æ—Ä–Ω—ã–µ), –õ–∏–ª–∏—Ç, –•–∏—Ä–æ–Ω, –í–µ—Ä—Ç–µ–∫—Å, –ü–∞—Ä—Å –§–æ—Ä—Ç—É–Ω—ã, —á–∞—Ä–∞-–∫–∞—Ä–∞–∫–∏, –∞—Ä—É–¥—Ö–∞-–ª–∞–≥–Ω–∞. –§—É–Ω–∫—Ü–∏—è `getAstroSnapshot(...)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏ JSON –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤.
- **geocode.js** ‚Äî –≥–µ–æ–∫–æ–¥–∏–Ω–≥ –º–µ—Å—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (Nominatim): —Å—Ç—Ä–æ–∫–∞ ‚Üí `{ lat, lon }`.
- **workerAstro.js** ‚Äî –ø–æ –∑–∞—è–≤–∫–µ: –≥–µ–æ–∫–æ–¥–∏–Ω–≥ ‚Üí —Ä–∞—Å—á—ë—Ç —Å–Ω–∞–ø—à–æ—Ç–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `astro_snapshots` –∏ –ø—Ä–∏–≤—è–∑–∫–∞ –∫ `track_requests`. –í—ã–∑–æ–≤: `computeAndSaveAstroSnapshot(supabase, trackRequestId)`.
- **promptTemplates.js** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏–∑ –ë–î (`prompt_templates` –ø–æ name –∏ is_active), –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `{{var}}`. –ì–ª–∞–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç: ¬´–ò–¥–µ–∞–ª—å–Ω–æ –æ—Ç–ª–∞–∂–µ–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç¬ª (MAIN_PROMPT_NAME = `ideally_tuned_system_v1`). –§—É–Ω–∫—Ü–∏–∏: `loadPrompt(supabase, name)`, `substituteVariables(body, values)`, `getRenderedPrompt(supabase, name, variables)`.
- **greetingTemplates.js** ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é **–≤–º–µ—Å—Ç–µ —Å –ø–µ—Å–Ω–µ–π** (–ø–æ —Ç–∏–ø—É –∑–∞–ø—Ä–æ—Å–∞: –æ—Ç–Ω–æ—à–µ–Ω–∏—è, —Ñ–∏–Ω–∞–Ω—Å—ã, –∑–¥–æ—Ä–æ–≤—å–µ, –¥—É—Ö–æ–≤–Ω—ã–π, –æ–±—â–∏–π). –§—É–Ω–∫—Ü–∏—è `getGreetingForSong(requestText, { name, title })` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —á–∞—Ç–∞ —Å Qwen3max –º–æ–∂–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –≤ `GREETINGS_BY_CATEGORY` –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.

### –ú–∏–≥—Ä–∞—Ü–∏—è prompt_templates (–≠—Ç–∞–ø 2)

–¢–∞–±–ª–∏—Ü–∞ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è DeepSeek/Suno –∏ –Ω–∞—á–∞–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (archetype, lyrics, title, suno_config). –í—ã–ø–æ–ª–Ω–∏ –≤ Supabase SQL Editor —Å–∫—Ä–∏–ø—Ç `bot/supabase-migration-prompt-templates.sql` (–ø–æ—Å–ª–µ `supabase-schema.sql`; –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ ¬´–ú–æ–∏ –≥–µ—Ä–æ–∏¬ª ‚Äî –ø–æ—Å–ª–µ `supabase-migration-master-heroes.sql`). –ì–ª–∞–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç ¬´–ò–¥–µ–∞–ª—å–Ω–æ –æ—Ç–ª–∞–∂–µ–Ω–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º—Ç¬ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ `bot/prompts/ideally_tuned_system.txt` –≤ —Ç–∞–±–ª–∏—Ü—É –∫–æ–º–∞–Ω–¥–æ–π: `npm run seed-ideally-tuned` (–Ω—É–∂–Ω—ã SUPABASE_URL –∏ SUPABASE_SERVICE_KEY –≤ `.env`).

## –î–∞–ª—å—à–µ

- **–í–æ—Ä–∫–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**: `npm run worker:full` –∏–ª–∏ `npm run worker:loop`. –ß–∏—Ç–∞–µ—Ç –∑–∞—è–≤–∫–∏ –∏–∑ `track_requests`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å—á–∏—Ç–∞–µ—Ç –∞—Å—Ç—Ä–æ, –∑–∞—Ç–µ–º DeepSeek ‚Üí Suno ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ –≤ Telegram.
- **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞**: –∫—É–¥–∞ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–π LLM, –¥—Ä—É–≥–æ–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º—É–∑—ã–∫–∏, —à–∞–≥–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞, –ø—Ä–æ–º–ø—Ç—ã ‚Äî —Å–º. [docs/RASSHIRENIE_PROEKTA.md](../docs/RASSHIRENIE_PROEKTA.md).
