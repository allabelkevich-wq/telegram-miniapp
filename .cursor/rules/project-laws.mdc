---
description: Незыблемые законы проекта YupSoul. Любое требование пользователя со словами «должно», «должна», «должен» автоматически становится законом и вносится в этот файл.
globs:
alwaysApply: true
---

# Законы проекта YupSoul

> Этот файл — свод незыблемых правил. Нарушать их ЗАПРЕЩЕНО.
> Любое новое требование пользователя, содержащее слова **«должно»**, **«должна»**, **«должен»**, автоматически становится законом и ДОЛЖНО быть добавлено в этот файл.

---

## ЗАКОН №1 — Автодополнение городов (места рождения) НЕЗЫБЛЕМО

**Дата принятия:** 2026-02-28

Функция автодополнения городов при вводе места рождения — **критически важная** и **неприкосновенная** часть приложения.

### Что это:
- Пользователь начинает вводить город (например, «Минск») → снизу появляется выпадающий список реальных городов из Nominatim → пользователь выбирает из списка, тем самым подтверждая свою локацию.

### Требования:
1. Автодополнение **ДОЛЖНО** работать на всех полях места рождения: `birthplace`, `birthplace2`, `heroBirthplace`, `transitLocation`.
2. Подсказки **ДОЛЖНЫ** появляться при вводе от 2 символов.
3. При выборе города из списка **ДОЛЖНА** ставиться отметка подтверждения (`data-place-selected`).
4. Бэкенд-прокси `/api/places` **ДОЛЖЕН** кэшировать результаты и корректно обрабатывать rate-limit (429) от Nominatim.
5. Фронтенд **ДОЛЖЕН** делать retry при ошибках 429/502/503 и показывать осмысленное сообщение пользователю.
6. Эту функцию **НЕЛЬЗЯ** удалять, отключать, упрощать или заменять на ручной ввод без подтверждения.

### Затронутые файлы:
- `public/index.html` — функции `fetchPlaces`, `fetchPlaces2`, `hFetchPlaces`, `showLocationSuggestions`, `getPlacesSearchUrl`
- `bot/index.js` — эндпоинт `/api/places`, кэш `_placesCache`, функция `_nominatimFetch`

---

## ЗАКОН №2 — Поле промокода ДОЛЖНО быть всегда видимым

**Дата принятия:** 2026-03-01

Поле ввода промокода — **обязательный и всегда видимый** элемент экрана оплаты.

### Требования:
1. Поле промокода **ДОЛЖНО** быть видно на экране оплаты всегда, без необходимости нажимать toggle/раскрывать.
2. Секция `#payOvPromoSection` **ДОЛЖНА** иметь `display:block` при открытии overlay оплаты.
3. Кнопка-toggle `#payOvPromoToggle` **ДОЛЖНА** быть скрыта (`display:none`) — поле открыто по умолчанию.
4. Эту функцию **НЕЛЬЗЯ** скрывать, убирать за toggle или делать невидимой по умолчанию.

### Затронутые файлы:
- `public/index.html` — функция `showPaymentOverlay`, HTML-разметка `#payOvPromoSection`, `#payOvPromoToggle`, `#payOvPromoInput`, `#payOvPromoBtn`

---

<!-- Новые законы добавлять ниже по шаблону:

## ЗАКОН №N — Краткое название

**Дата принятия:** YYYY-MM-DD

Описание закона и требования.

-->
