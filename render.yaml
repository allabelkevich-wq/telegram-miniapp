# Render Blueprint: бот + воркер генерации.
# Деплой только из ветки main. Один источник правды: public/index.html (копируем в bot/public при сборке).
# Переменные (BOT_TOKEN, SUPABASE_*, DEEPSEEK_API_KEY, SUNO_API_KEY) задай в Dashboard для обоих сервисов.
services:
  - type: web
    name: yupsoul-bot
    runtime: node
    plan: free
    # Без rootDir — сборка из корня репо, чтобы скопировать public/index.html в bot/public/
    buildCommand: cp public/index.html bot/public/ && cp -f public/landing.html bot/public/ 2>/dev/null; cp -r public/assets/icons bot/public/assets/ && cd bot && npm install
    startCommand: cd bot && npm start
    healthCheckPath: /healthz

  - type: worker
    name: yupsoul-worker
    runtime: node
    plan: free
    rootDir: bot
    buildCommand: npm install
    startCommand: node worker-loop.js
    envVars:
      - key: WORKER_INTERVAL_MS
        value: "300000"
