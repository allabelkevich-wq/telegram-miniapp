# Статус проекта по чек-листу (на 08.02.2026)

Сверка с **CHECKLIST_5_STAGES.md**. Архитектура проекта упрощённая: Mini App (форма) → бот → Supabase → воркер (астро + DeepSeek + Suno) → отправка аудио в Telegram.

---

## Этап 1 — Telegram-бот (MVP)

| Пункт чек-листа | Статус | Реализация в проекте |
|-----------------|--------|----------------------|
| Инфраструктура Supabase, таблицы | ✅ Частично | Есть: track_requests, astro_snapshots, prompt_templates, clients (герои). Нет: telegram_accounts, profiles, track_jobs, payments, products, energy_* — не используются в текущем потоке. |
| Бот в BotFather, /start | ✅ | index.js: бот на grammY, команда /start, кнопка «Открыть приложение» (Mini App). |
| Онбординг: сбор данных | ✅ | В Mini App: имя, дата/время/место рождения, пол, **язык песни**, запрос. Подтверждение места (Nominatim). Данные уходят в заявке (web_app_data). |
| Создание запроса на трек | ✅ | Кнопка «Отправить заявку» → sendData → сохранение в track_requests (status pending). |
| Подписки, Stars, энергия | ❌ | Не реализовано. Сейчас: донат/реквизиты в форме, без привязки к Stars или энергии. |
| Мок-воркер | ✅ Превышено | Реальный воркер: workerAstro (астро), workerGenerate (DeepSeek + Suno + отправка аудио). |
| «Мои треки» в боте | ⚪ Частично | Нет отдельной команды «Мои треки» для пользователя. Админка /admin — список заявок для админа. |
| Админка в боте | ✅ | /admin (список заявок), /admin_check (проверка Supabase). Уведомление админу при новой заявке. |

**Итог этапа 1:** бот, Mini App, заявки, админка и уведомления работают. Нет подписок/Stars/энергии и отдельной команды «Мои треки» для юзера.

---

## Этап 2 — Реальный пайплайн генерации

| Пункт чек-листа | Статус | Реализация в проекте |
|-----------------|--------|----------------------|
| Астродвижок (сидерика, Placidus, Lahiri) | ✅ | astroLib.js (swisseph), workerAstro.js, геокодинг, astro_snapshots. |
| Система промптов в БД | ✅ | prompt_templates, promptTemplates.js, подстановка переменных. Промпт «Идеально отлаженный» (ideally_tuned_system_v1). |
| Интеграция DeepSeek | ✅ | deepseek.js (chatCompletion), вызов в workerGenerate, подстановка в промпт из БД. |
| Интеграция Suno | ✅ | suno.js: generateMusic, pollMusicResult. Custom mode, лирика + title + style. |
| Очередь/воркер по шагам | ⚪ Упрощённо | Один воркер workerGenerate: pending → LLM → Suno → отправка. Нет track_jobs, step/attempt, ретраев. |
| Уведомление пользователю | ✅ | sendAudio в Telegram по telegram_user_id при status=completed. |

**Итог этапа 2:** полный пайплайн реализован: астро → промпт → DeepSeek → Suno → отправка аудио. Очередь без отдельной таблицы track_jobs и без разбивки на шаги.

---

## Этап 3 — Веб-сайт

| Пункт чек-листа | Статус | Реализация в проекте |
|-----------------|--------|----------------------|
| Next.js, Supabase Auth на сайте | ❌ | Отдельного веб-сайта нет. Есть Mini App (статичный HTML на GitHub Pages). |
| «Мои герои» (тариф Мастер) | ✅ | HTTP API в боте (/api/me, /api/heroes), Mini App: раздел «Мои герои», селект «Для кого создаём?», client_id в заявке. |

**Итог этапа 3:** полноценного сайта на Next.js нет; Mini App и «Мои герои» реализованы.

---

## Этап 4 — Админка

| Пункт чек-листа | Статус | Реализация в проекте |
|-----------------|--------|----------------------|
| Роль admin, RLS | ⚪ Частично | Админ по ADMIN_TELEGRAM_IDS в .env. Нет ролей в Supabase. |
| Разделы: пользователи, треки, модерация, промпты, аналитика | ❌ | Только /admin (список заявок) и /admin_check в боте. Нет веб-админки. |

**Итог этапа 4:** админка только в боте (список заявок). Полноценной веб-админки нет.

---

## Этап 5 — Реферальная система

| Пункт чек-листа | Статус |
|-----------------|--------|
| Таблица referrals, коды, бонусы | ❌ Не реализовано |

---

## Дополнительно реализовано (вне чек-листа)

- Выбор **языка** песни и описания в форме (ru/en/uk).
- Сообщение после отправки заявки: «Заявка отправлена. Можно закрыть приложение».
- Деплой бота на **Render** (0.0.0.0, PORT, /healthz).
- **render.yaml** и инструкции по деплою и переменным.
- Документация: деплой на Render, SQL в Supabase, воркер автоматизации, уведомления админу.

---

## Краткий вывод

- **Работает:** бот, Mini App (форма + место рождения + язык), заявки в Supabase, расчёт натальной карты, генерация текста (DeepSeek) и музыки (Suno), отправка аудио пользователю, админка в боте (/admin, уведомления), «Мои герои», деплой на Render.
- **Нет в проекте:** подписки/Stars/энергия, отдельный веб-сайт на Next.js, полноценная веб-админка, реферальная система, таблица track_jobs и пошаговый воркер с ретраями.

Для текущей цели («заявка → песня → пользователю») проект реализован; остальное — расширения по чек-листу.
