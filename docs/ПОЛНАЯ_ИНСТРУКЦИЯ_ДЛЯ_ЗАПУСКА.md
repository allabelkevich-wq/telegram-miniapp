# Полная инструкция: что нужно для работы приложения YupSoul

Пошагово — от нуля до работающего бота и админки. Если что-то уже сделано — переходи к следующему шагу.

---

## Часть 1. Минимум без Supabase (заявки только в памяти бота)

Этого достаточно, чтобы приложение открывалось, заявки приходили в бота, а ты видела их по команде /admin. После перезапуска бота старые заявки пропадут (если не подключить Supabase).

### 1.1 Установить Node.js (если ещё нет)

- Скачай с https://nodejs.org (версия LTS) и установи, **или**
- В терминале: `brew install node` (если установлен Homebrew).

Проверка: в терминале выполни `node -v` — должна показаться версия.

### 1.2 Настроить бота

1. Открой папку проекта и зайди в папку бота:
   ```bash
   cd /Users/arhan/telegram-miniapp/bot
   ```
2. Убедись, что есть файл **`.env`** с такими строками (подставь свои данные):
   ```env
   BOT_TOKEN=твой_токен_от_BotFather
   MINI_APP_URL=https://allabelkevich-wq.github.io/telegram-miniapp/
   ADMIN_TELEGRAM_IDS=619065619
   ```
   - **BOT_TOKEN** — из @BotFather (команда /mybots → твой бот → API Token).
   - **ADMIN_TELEGRAM_IDS** — твой Telegram ID (узнать: написать @userinfobot в Telegram).

3. Установи зависимости (один раз):
   ```bash
   npm install
   ```

### 1.3 Запустить бота

В терминале:

```bash
cd /Users/arhan/telegram-miniapp/bot
npm start
```

Оставь терминал открытым. Должно появиться: `Бот запущен: Yup_Soul_bot` и `Админы (ID): 619065619`.

- Пока бот запущен — он принимает заявки и отвечает на /admin.
- Остановка: **Ctrl+C** в терминале.

### 1.4 Кнопка «Открыть приложение» в Telegram

Если при открытии бота нет кнопки под полем ввода или она не открывает приложение:

1. Открой в Telegram **@BotFather**.
2. Отправь **/mybots** → выбери своего бота.
3. **Bot Settings** → **Menu Button** → **Configure menu button**.
4. URL вставь **ровно такой** (скопируй из файла `ССЫЛКА_ДЛЯ_КНОПКИ_БОТА.txt` в корне проекта):
   ```
   https://allabelkevich-wq.github.io/telegram-miniapp/
   ```
5. Текст кнопки: **Открыть приложение** (или YupSoul).

### 1.5 Проверить /admin

1. В Telegram открой чат с ботом **с того аккаунта**, чей ID указан в `ADMIN_TELEGRAM_IDS`.
2. Напиши **/admin**.
3. Бот должен сначала ответить «Проверяю заявки…», затем — либо список заявок, либо «Заявок пока нет».

**Если сообщение «грузит» и не приходит:**

- Убедись, что бот **действительно запущен** (терминал с `npm start` открыт, нет ошибок).
- Перезапусти бота (Ctrl+C, затем снова `npm start`).
- Проверь, что в `.env` указан **твой** Telegram ID и бот перезапущен после правки.

---

## Часть 2. Подключение Supabase (постоянное хранение заявок)

Supabase — бесплатная база данных. После подключения заявки сохраняются и не пропадают при перезапуске бота. Команда /admin будет показывать заявки из базы.

**Я не могу создать аккаунт или проект за тебя** — это делается на сайте supabase.com. Ниже — пошагово, что нажать и куда вставить данные.

### 2.1 Регистрация и создание проекта

1. Открой в браузере: **https://supabase.com**
2. Нажми **Start your project** и войди через GitHub (или email).
3. После входа нажми **New Project**.
4. Заполни:
   - **Name** — например, `yupsoul`
   - **Database Password** — придумай надёжный пароль и **сохрани его** (для входа в дашборд).
   - **Region** — выбери ближайший (например, Frankfurt).
5. Нажми **Create new project**. Подожди 1–2 минуты, пока проект создаётся.

### 2.2 Создать таблицу заявок

1. В левом меню Supabase открой **SQL Editor**.
2. Нажми **New query**.
3. Открой в своём проекте файл **`bot/supabase-schema.sql`** и скопируй его содержимое целиком.
4. Вставь скопированный текст в окно запроса в Supabase.
5. Нажми **Run** (или Ctrl+Enter). Внизу должно появиться сообщение об успешном выполнении.

### 2.3 Скопировать ключи для бота

1. В левом меню Supabase открой **Project Settings** (иконка шестерёнки внизу).
2. Перейди в раздел **API**.
3. Найди блок **Project URL** — скопируй ссылку (например, `https://xxxxx.supabase.co`).
4. Найди блок **Project API keys**. Скопируй ключ **service_role** (длинная строка, начинается с `eyJ...`).  
   ⚠️ **Не путай с `anon`** — нужен именно **service_role**. Его не показывай публично.

### 2.4 Вписать данные в бота

1. Открой файл **`bot/.env`** в проекте.
2. Добавь (или раскомментируй и вставь свои значения) две строки:

```env
SUPABASE_URL=сюда_вставь_Project_URL_из_Supabase
SUPABASE_SERVICE_KEY=сюда_вставь_ключ_service_role
```

Пример (подставь свои):

```env
SUPABASE_URL=https://abcdefghijk.supabase.co
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

3. Сохрани файл.

### 2.5 Перезапустить бота

В терминале нажми **Ctrl+C**, затем снова:

```bash
cd /Users/arhan/telegram-miniapp/bot
npm start
```

После этого новые заявки будут сохраняться в Supabase, а по команде /admin бот будет показывать заявки из базы. Старые заявки из памяти при первом запуске с Supabase не появятся — только новые.

---

## Краткий чек-лист «Всё работает»

- [ ] Node.js установлен (`node -v` в терминале).
- [ ] В `bot/.env` есть `BOT_TOKEN`, `MINI_APP_URL`, `ADMIN_TELEGRAM_IDS`.
- [ ] Выполнено `npm install` в папке `bot`.
- [ ] Бот запущен (`npm start`), в консоли есть «Бот запущен» и «Админы (ID): …».
- [ ] В @BotFather настроена кнопка меню с URL приложения.
- [ ] В чате с ботом кнопка открывает приложение, заявка отправляется и бот отвечает «Заявка принята!».
- [ ] Команда /admin с твоего аккаунта отвечает («Проверяю заявки…» и список или «Заявок пока нет»).
- [ ] (По желанию) Supabase создан, таблица создана, в `.env` добавлены `SUPABASE_URL` и `SUPABASE_SERVICE_KEY`, бот перезапущен.

Если на каком-то шаге что-то не получается — напиши, на каком именно шаге и что видишь на экране (или какая ошибка в консоли).
