# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–ø–ª–∞—Ç –∏ –ø–æ–ø—ã—Ç–æ–∫ –≤ –∞–¥–º–∏–Ω–∫–µ

–ö–∞–∫ –≤ –∞–¥–º–∏–Ω–∫–µ —É–≤–∏–¥–µ—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã –∏ —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–ª–∞—Ç—ã, –∏ –∫–∞–∫ —ç—Ç–∏–º —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏.

---

## –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å

### 1. –°–≤–æ–¥–∫–∞ –ø–æ –æ–ø–ª–∞—Ç–∞–º (–≤–∫–ª–∞–¥–∫–∞ ¬´–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è¬ª)

- **–û–ø–ª–∞—á–µ–Ω–æ –∑–∞ 24 —á** ‚Äî —á–∏—Å–ª–æ –∑–∞—è–≤–æ–∫ —Å —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–æ–π (paid / gift_used / subscription_active) –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—É—Ç–∫–∏.
- **–û–ø–ª–∞—á–µ–Ω–æ –∑–∞ 7 –¥–Ω** ‚Äî —Ç–æ –∂–µ –∑–∞ –Ω–µ–¥–µ–ª—é.
- **–û–∂–∏–¥–∞—é—Ç (checkout –æ—Ç–∫—Ä—ã—Ç)** ‚Äî –∑–∞—è–≤–∫–∏, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª –∏ —Å–æ–∑–¥–∞–ª—Å—è order (–µ—Å—Ç—å `payment_order_id`), –Ω–æ –≤–µ–±—Ö—É–∫ –µ—â—ë –Ω–µ –ø—Ä–∏—à—ë–ª (`payment_status` = pending / requires_payment). –≠—Ç–æ –∏ –µ—Å—Ç—å **–ø–æ–ø—ã—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã** (checkout –æ—Ç–∫—Ä—ã—Ç, –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞).

### 2. –¢–∞–±–ª–∏—Ü–∞ ¬´–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–ª–∞—Ç—ã¬ª

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞—è–≤–∫–∏ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º `payment_provider` (HOT, –ø—Ä–æ–º–æ, –ø–æ–¥–ø–∏—Å–∫–∞ –∏ —Ç.–¥.):

- **–°—Ç–∞—Ç—É—Å:** ‚úì –û–ø–ª–∞—á–µ–Ω–æ / üéÅ –ü–æ–¥–∞—Ä–æ–∫ / üìã –ü–æ–¥–ø–∏—Å–∫–∞ / ‚è≥ –û–∂–∏–¥–∞–µ—Ç.
- **Order / TX** ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –ø–ª–∞—Ç–µ–∂–∞ (–¥–ª—è —Å–≤–µ—Ä–∫–∏ —Å HOT –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π).
- –ü–æ ¬´–î–∞—Ç–∞¬ª –∏ ¬´Request ID¬ª –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞—è–≤–∫—É –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ä—Ç–æ—á–∫—É.

### 3. –ó–∞—è–≤–∫–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º ¬´üí≥ –û–ø–ª–∞—Ç–∞¬ª

–ù–∞ –≤–∫–ª–∞–¥–∫–µ –∑–∞—è–≤–æ–∫ —Ñ–∏–ª—å—Ç—Ä **¬´üí≥ –û–ø–ª–∞—Ç–∞¬ª** ‚Äî —ç—Ç–æ –∑–∞—è–≤–∫–∏ –≤ —Å—Ç–∞—Ç—É—Å–µ **–æ–∂–∏–¥–∞–Ω–∏—è –æ–ø–ª–∞—Ç—ã** (`generation_status = pending_payment`). –ó–¥–µ—Å—å –≤–∏–¥–Ω—ã —Ç–µ, –∫—Ç–æ –µ—â—ë –Ω–µ –æ–ø–ª–∞—Ç–∏–ª –∏–ª–∏ —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã–ª checkout.

### 4. –†—É—á–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞ ¬´–û–ø–ª–∞—á–µ–Ω–æ¬ª

–í –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞—è–≤–∫–∏ (–µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å ¬´–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã¬ª) –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ **¬´–û—Ç–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª**. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–æ–≥–¥–∞:

- –¥–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–ª–∏—Å—å, –Ω–æ –≤–µ–±—Ö—É–∫ –Ω–µ –ø—Ä–∏—à—ë–ª –∏ —Ç–∞—Ä–∏—Ñ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è;
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª, —á—Ç–æ –æ–ø–ª–∞—Ç–∏–ª, –∞ –≤ —Å–∏—Å—Ç–µ–º–µ –≤—Å—ë –µ—â—ë ¬´–æ–∂–∏–¥–∞–µ—Ç¬ª.

–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∑–∞—è–≤–∫–µ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è `payment_status = paid`, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É.

---

## –ö–∞–∫ —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å ¬´–ø–æ–ø—ã—Ç–∫—É¬ª –∏ ¬´–æ–ø–ª–∞—Ç—É¬ª

| –°–∏—Ç—É–∞—Ü–∏—è | –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å | –ß—Ç–æ –¥–µ–ª–∞—Ç—å |
|----------|----------------|------------|
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª ¬´–û–ø–ª–∞—Ç–∏—Ç—å¬ª, —É—à—ë–ª –≤ HOT | ¬´–û–∂–∏–¥–∞—é—Ç (checkout –æ—Ç–∫—Ä—ã—Ç)¬ª –≤ —Å–≤–æ–¥–∫–µ; –≤ ¬´–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–ª–∞—Ç—ã¬ª ‚Äî —Å—Ç—Ä–æ–∫–∞ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ¬´‚è≥ –û–∂–∏–¥–∞–µ—Ç¬ª –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º Order | –ñ–¥–∞—Ç—å –≤–µ–±—Ö—É–∫ (–æ–±—ã—á–Ω–æ –¥–æ 1‚Äì2 –º–∏–Ω). –ï—Å–ª–∏ –¥–æ–ª–≥–æ ‚Äî —Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏. |
| –î–µ–Ω—å–≥–∏ —Å–ø–∏—Å–∞–ª–∏—Å—å, —Ç–∞—Ä–∏—Ñ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è | –¢–∞ –∂–µ –∑–∞—è–≤–∫–∞ –≤ ¬´–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–ª–∞—Ç—ã¬ª –∏–ª–∏ –ø–æ–∏—Å–∫ –ø–æ request_id / user_id | –í –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞—è–≤–∫–∏ –Ω–∞–∂–∞—Ç—å ¬´–û—Ç–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª. –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ —Ç–∞—Ä–∏—Ñ –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã. |
| –ù—É–∂–Ω–æ –ø–æ–Ω—è—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏—é ¬´–ø–æ–ø—ã—Ç–∫–∞ ‚Üí –æ–ø–ª–∞—Ç–∞¬ª | –°–≤–æ–¥–∫–∞: ¬´–û–ø–ª–∞—á–µ–Ω–æ –∑–∞ 24 —á¬ª vs ¬´–û–∂–∏–¥–∞—é—Ç¬ª. –¢–∞–±–ª–∏—Ü–∞ ¬´–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–ª–∞—Ç—ã¬ª ‚Äî —Å—Ä–∞–≤–Ω–∏—Ç—å —á–∏—Å–ª–æ —Å—Ç—Ä–æ–∫ ¬´‚úì –û–ø–ª–∞—á–µ–Ω–æ¬ª –∏ ¬´‚è≥ –û–∂–∏–¥–∞–µ—Ç¬ª –∑–∞ –ø–µ—Ä–∏–æ–¥ | –î–ª—è –º–∞—Å—à—Ç–∞–±–∞ –º–æ–∂–Ω–æ –≤—ã–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ —Å—á–∏—Ç–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ (–ø–æ –¥–∞—Ç–∞–º). |

---

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏

1. **–õ–æ–≥–∏ –≤–µ–±—Ö—É–∫–∞** (Render ‚Üí Logs): –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ `POST /api/payments/hot/webhook`. –û—à–∏–±–∫–∏ 401 (–ø–æ–¥–ø–∏—Å—å), 500 (–ë–î/–∫–æ–¥) ‚Äî –ø—Ä–∏—á–∏–Ω–∞, –ø–æ—á–µ–º—É –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è.
2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ HOT** –≤ Render: `HOT_WEBHOOK_SECRET`, `HOT_NOTIFY_URL` (–∏–ª–∏ —á—Ç–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ `notify_url`). URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω —Å–Ω–∞—Ä—É–∂–∏ (HOT –¥–æ–ª–∂–µ–Ω –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è).
3. **¬´–û–∂–∏–¥–∞—é—Ç¬ª –Ω–µ —Ç–∞—é—Ç** ‚Äî –º–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π —Å Order, –Ω–æ –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ paid: –≤–æ–∑–º–æ–∂–Ω—ã —Å–±–æ–∏ –≤–µ–±—Ö—É–∫–∞ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç checkout –±–µ–∑ –æ–ø–ª–∞—Ç—ã.
4. **–†—É—á–Ω–∞—è –æ—Ç–º–µ—Ç–∫–∞** ‚Äî –µ—Å–ª–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ ¬´–û—Ç–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª, —Å—Ç–æ–∏—Ç —Ä–∞–∑–æ–±—Ä–∞—Ç—å, –ø–æ—á–µ–º—É –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–µ–±—Ö—É–∫ (–ø–æ–¥–ø–∏—Å—å, —Ç–∞–π–º–∞—É—Ç—ã, —Å–µ—Ç—å).

---

## API –¥–ª—è —Å–≤–æ–∏—Ö –æ—Ç—á—ë—Ç–æ–≤

- `GET /api/admin/payments?limit=200` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ (–æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∏ –æ–∂–∏–¥–∞—é—â–∏–µ).
- `GET /api/admin/payments/stats` ‚Äî —Å–≤–æ–¥–∫–∞: `paid_24h`, `paid_7d`, `pending_count`.

–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –∞–¥–º–∏–Ω-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π (initData –∞–¥–º–∏–Ω–∞ –∏–ª–∏ —Ç–æ–∫–µ–Ω).

---

## –ö—Ä–∞—Ç–∫–æ

- **–ü–æ–ø—ã—Ç–∫–∏ –æ–ø–ª–∞—Ç—ã** = –∑–∞—è–≤–∫–∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º checkout (–µ—Å—Ç—å `payment_order_id`, —Å—Ç–∞—Ç—É—Å –µ—â—ë –Ω–µ paid). –í–∏–¥–Ω—ã –≤ —Å–≤–æ–¥–∫–µ ¬´–û–∂–∏–¥–∞—é—Ç (checkout –æ—Ç–∫—Ä—ã—Ç)¬ª –∏ –≤ —Ç–∞–±–ª–∏—Ü–µ ¬´–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–ª–∞—Ç—ã¬ª —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º ¬´‚è≥ –û–∂–∏–¥–∞–µ—Ç¬ª.
- **–£—Å–ø–µ—à–Ω—ã–µ –æ–ø–ª–∞—Ç—ã** = ¬´–û–ø–ª–∞—á–µ–Ω–æ –∑–∞ 24 —á / 7 –¥–Ω¬ª –∏ —Å—Ç—Ä–æ–∫–∏ ¬´‚úì –û–ø–ª–∞—á–µ–Ω–æ¬ª –≤ —Ç–∞–±–ª–∏—Ü–µ.
- **–ö—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ:** —Ä–∞–∑ –≤ –¥–µ–Ω—å —Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–¥–∫—É; –ø—Ä–∏ –∂–∞–ª–æ–±–∞—Ö ¬´–æ–ø–ª–∞—Ç–∏–ª, –Ω–æ —Ç–∞—Ä–∏—Ñ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è¬ª ‚Äî –∏—Å–∫–∞—Ç—å –∑–∞—è–≤–∫—É –∏ –Ω–∞–∂–∞—Ç—å ¬´–û—Ç–º–µ—Ç–∏—Ç—å –æ–ø–ª–∞—Ç—É¬ª; –ø—Ä–∏ —Ä–æ—Å—Ç–µ ¬´–û–∂–∏–¥–∞—é—Ç¬ª –±–µ–∑ —Ä–æ—Å—Ç–∞ –æ–ø–ª–∞—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ–±—Ö—É–∫ –∏ –ª–æ–≥–∏.
