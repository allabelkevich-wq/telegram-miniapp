# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã YupSoul

## –¶–µ–ª—å
–ß–∏—Å—Ç–∞—è, –ø–æ–Ω—è—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø–ª–∞—Ç—ã –±–µ–∑ –±–∞–≥–æ–≤, –ø—É—Å—Ç—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ –∏ –ø—É—Ç–∞–Ω–∏—Ü—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## –ü–æ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É (–∏–º—è, –¥–∞—Ç–∞, –º–µ—Å—Ç–æ, –∑–∞–ø—Ä–æ—Å) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ –ù–∞–∂–∏–º–∞–µ—Ç ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª   ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                           ‚ñº
          POST /api/submit-request (—Å initData)
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚ñº                  ‚ñº                  ‚ñº
    200 OK            402 Payment         4xx/5xx
  (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)         Required            (–æ—à–∏–±–∫–∞)
        ‚îÇ                  ‚îÇ                  ‚îÇ
        ‚ñº                  ‚ñº                  ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ FREE    ‚îÇ      ‚îÇ PAID        ‚îÇ     ‚îÇ ERROR   ‚îÇ
   ‚îÇ (gift/  ‚îÇ      ‚îÇ (–Ω—É–∂–Ω–∞      ‚îÇ     ‚îÇ (alert) ‚îÇ
   ‚îÇ  sub)   ‚îÇ      ‚îÇ  –æ–ø–ª–∞—Ç–∞)    ‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                  ‚îÇ
        ‚ñº                  ‚ñº
   loadingPage      paymentOverlay
        ‚îÇ                  ‚îÇ
        ‚ñº                  ‚îÇ
   successPage             ‚îÇ
                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                                     ‚îÇ
        ‚ñº                                     ‚ñº
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ FREE TRIAL  ‚îÇ                   ‚îÇ PROMO CODE  ‚îÇ
   ‚îÇ (–ø–µ—Ä–≤—ã–π     ‚îÇ                   ‚îÇ –∏–ª–∏ HOT PAY ‚îÇ
   ‚îÇ  –ø–æ–¥–∞—Ä–æ–∫)   ‚îÇ                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                            ‚îÇ
        ‚îÇ                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚ñº                          ‚ñº                       ‚ñº
   üéÅ –ü–æ–ª—É—á–∏—Ç—å             –ü—Ä–æ–º–æ–∫–æ–¥ –¥–∞—ë—Ç 0        –ü—Ä–æ–º–æ–∫–æ–¥ –¥–∞—ë—Ç >0
   –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á         (–∏–ª–∏ –Ω–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥–∞)    –∏–ª–∏ –Ω–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥–∞
        ‚îÇ                          ‚îÇ                       ‚îÇ
        ‚ñº                          ‚ñº                       ‚ñº
   POST /api/free-trial/claim  üéÅ –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ  üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ HOT
        ‚îÇ                          ‚îÇ                       ‚îÇ
        ‚ñº                          ‚ñº                       ‚ñº
   hidePaymentOverlay      POST /api/payments/hot/create  POST /api/payments/hot/create
        ‚îÇ                   (promo ‚Üí free_applied)         (checkout_url)
        ‚ñº                          ‚îÇ                       ‚îÇ
   loadingPage                     ‚ñº                       ‚ñº
        ‚îÇ                   hidePaymentOverlay       –û—Ç–∫—Ä—ã—Ç—å HOT —Å—Å—ã–ª–∫—É
        ‚ñº                          ‚îÇ                       ‚îÇ
   successPage                     ‚ñº                       ‚ñº
                            loadingPage              –ü–æ–∫–∞–∑–∞—Ç—å ¬´–Ø —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª¬ª
                                   ‚îÇ                       ‚îÇ
                                   ‚ñº                       ‚ñº
                            successPage           –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (polling)
                                                          ‚îÇ
                                                          ‚ñº
                                                   hidePaymentOverlay
                                                          ‚îÇ
                                                          ‚ñº
                                                   loadingPage ‚Üí successPage
```

---

## –°–æ—Å—Ç–æ—è–Ω–∏—è –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã (`paymentOverlay`)

### 1. **INITIAL** (–æ—Ç–∫—Ä—ã—Ç–∏–µ)
- **–ö–æ–≥–¥–∞:** –ü–æ—Å–ª–µ `402 Payment Required` –æ—Ç `/api/submit-request`
- **–ü–æ–∫–∞–∑–∞—Ç—å:**
  - –¶–µ–Ω–∞ (–∏–∑ `pricingCatalog` –ø–æ `getCurrentSku()`)
  - –ü–æ–ª–µ –¥–ª—è –ø—Ä–æ–º–æ–∫–æ–¥–∞
  - –ö–Ω–æ–ø–∫–∞ ¬´üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ HOT Pay¬ª (—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è)
  - –ï—Å–ª–∏ `freeTrialAvailable === true` ‚Üí –∫–Ω–æ–ø–∫–∞ ¬´üéÅ –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á¬ª (–∑–µ–ª—ë–Ω–∞—è)
- **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
  - `pendingPaymentRequestId` ‚Äî ID –∑–∞—è–≤–∫–∏ (–∏–∑ –æ—Ç–≤–µ—Ç–∞ 402)
  - `pendingPaymentSku` ‚Äî SKU (–∏–∑ –æ—Ç–≤–µ—Ç–∞ –∏–ª–∏ `getCurrentSku()`)
  - `activePromo` ‚Äî `null` (—Å–±—Ä–æ—à–µ–Ω –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏)

### 2. **PROMO_APPLIED (amount_after = 0)**
- **–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª –ø—Ä–æ–º–æ–∫–æ–¥ ‚Üí `/api/promos/validate` ‚Üí `amount_after: 0`
- **–ü–æ–∫–∞–∑–∞—Ç—å:**
  - –¶–µ–Ω–∞: ~~5.99~~ ‚Üí **0 USDT** (–∑–∞—á—ë—Ä–∫–Ω—É—Ç–æ)
  - –ü–æ–¥—Å–∫–∞–∑–∫–∞: ¬´–ü—Ä–æ–º–æ–∫–æ–¥ `XXX` –ø—Ä–∏–º–µ–Ω—ë–Ω: —Å–∫–∏–¥–∫–∞ 5.99 USDT¬ª
  - –ö–Ω–æ–ø–∫–∞: **¬´üéÅ –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ¬ª** (–∑–µ–ª—ë–Ω–∞—è)
- **–ö–ª–∏–∫:**
  1. `POST /api/payments/hot/create` —Å `promo_code`
  2. –ï—Å–ª–∏ `free_applied: true` ‚Üí `hidePaymentOverlay()` + `goToPage('loadingPage')` + `successPage` (4 —Å–µ–∫)
  3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏

### 3. **PROMO_APPLIED (amount_after > 0)**
- **–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤—ë–ª –ø—Ä–æ–º–æ–∫–æ–¥ ‚Üí `/api/promos/validate` ‚Üí `amount_after: 2.99`
- **–ü–æ–∫–∞–∑–∞—Ç—å:**
  - –¶–µ–Ω–∞: ~~5.99~~ ‚Üí **2.99 USDT** (–∑–∞—á—ë—Ä–∫–Ω—É—Ç–æ)
  - –ü–æ–¥—Å–∫–∞–∑–∫–∞: ¬´–ü—Ä–æ–º–æ–∫–æ–¥ `XXX` –ø—Ä–∏–º–µ–Ω—ë–Ω: —Å–∫–∏–¥–∫–∞ 3.00 USDT¬ª
  - –ö–Ω–æ–ø–∫–∞: **¬´üí≥ –û–ø–ª–∞—Ç–∏—Ç—å 2.99 USDT¬ª** (—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è)
- **–ö–ª–∏–∫:**
  1. `POST /api/payments/hot/create` —Å `promo_code`
  2. –ü–æ–ª—É—á–∏—Ç—å `checkout_url` ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ (`tg.openLink`)
  3. –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É ¬´‚úÖ –Ø —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å¬ª

### 4. **HOT_PAY (–±–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞)**
- **–ö–æ–≥–¥–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–≤—ë–ª –ø—Ä–æ–º–æ–∫–æ–¥ –∏–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –ø–æ–¥–æ—à—ë–ª
- **–ü–æ–∫–∞–∑–∞—Ç—å:**
  - –¶–µ–Ω–∞: **5.99 USDT**
  - –ö–Ω–æ–ø–∫–∞: **¬´üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ HOT Pay¬ª** (—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è)
- **–ö–ª–∏–∫:**
  1. `POST /api/payments/hot/create` –±–µ–∑ `promo_code`
  2. –ü–æ–ª—É—á–∏—Ç—å `checkout_url` ‚Üí –æ—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
  3. –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É ¬´‚úÖ –Ø —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å¬ª

### 5. **FREE_TRIAL_CLAIM**
- **–ö–æ–≥–¥–∞:** `freeTrialAvailable === true` (–ø–µ—Ä–≤—ã–π —Ä–∞–∑ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏)
- **–ü–æ–∫–∞–∑–∞—Ç—å:**
  - –ü–æ–¥—Å–∫–∞–∑–∫–∞: ¬´üéÅ –≠—Ç–æ —Ç–≤–æ—è –ø–µ—Ä–≤–∞—è –∑–∞—è–≤–∫–∞ ‚Äî –æ–Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞!¬ª
  - –ö–Ω–æ–ø–∫–∞: **¬´üéÅ –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á¬ª** (–∑–µ–ª—ë–Ω–∞—è, –Ω–∞–¥ –∫–Ω–æ–ø–∫–æ–π –æ–ø–ª–∞—Ç—ã)
- **–ö–ª–∏–∫:**
  1. `POST /api/free-trial/claim` —Å `request_id`
  2. –ï—Å–ª–∏ `ok: true` ‚Üí `hidePaymentOverlay()` + `goToPage('loadingPage')` + `successPage` (4 —Å–µ–∫)
  3. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏

---

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞—Ç—å

1. **–í—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
   ```javascript
   console.log('[Payment Overlay] pendingPaymentRequestId:', pendingPaymentRequestId);
   console.log('[Payment Overlay] freeTrialAvailable:', freeTrialAvailable);
   console.log('[Payment Overlay] activePromo:', activePromo);
   ```

2. **–ü—Ä–∏ `free_applied: true` ‚Äî —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å:**
   ```javascript
   if (hotJson.free_applied) {
     hidePaymentOverlay();
     goToPage('loadingPage');
     setTimeout(() => goToPage('successPage'), 4000);
     return; // –ö–†–ò–¢–ò–ß–ù–û: –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –¥–∞–ª—å—à–µ
   }
   ```

3. **–°–±—Ä–∞—Å—ã–≤–∞—Ç—å `activePromo` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞:**
   ```javascript
   function showPaymentOverlay() {
     activePromo = null; // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–≤–µ—Å—Ç–∏ –Ω–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥
     // ...
   }
   ```

4. **–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á" —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `freeTrialAvailable`:**
   ```javascript
   if (freeTrialAvailable) {
     if (freeClaimBtn) freeClaimBtn.style.display = '';
   } else {
     if (freeClaimBtn) freeClaimBtn.style.display = 'none';
   }
   ```

5. **–í—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è—Ç—å UI –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:**
   ```javascript
   updatePaymentUiFromCatalog(); // –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞, –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞ –∏ —Ç.–¥.
   ```

### ‚ùå –ß–µ–≥–æ –ù–ï –¥–µ–ª–∞—Ç—å

1. **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:**
   - –ü–æ—Å–ª–µ `free_applied` ‚Äî –≤—Å–µ–≥–¥–∞ `hidePaymentOverlay()` + `goToPage('loadingPage')`
   - –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã ‚Äî –≤—Å–µ–≥–¥–∞ `hidePaymentOverlay()` + `goToPage('loadingPage')`

2. **–ù–ï –æ—Å—Ç–∞–≤–ª—è—Ç—å `pendingPaymentRequestId` –ø—É—Å—Ç—ã–º:**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º –æ–ø–ª–∞—Ç—ã
   - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ `null` ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–Ω—è—Ç–Ω—É—é –æ—à–∏–±–∫—É

3. **–ù–ï –∑–∞–±—ã–≤–∞—Ç—å —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏:**
   ```javascript
   function hidePaymentOverlay() {
     activePromo = null;
     pendingPaymentRequestId = null; // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –∑–∞—è–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
     // –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–ª—è, –∫–Ω–æ–ø–∫–∏, —Å—Ç–∞—Ç—É—Å—ã
   }
   ```

4. **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –æ–ø–ª–∞—Ç—ã –µ—Å–ª–∏ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–∞—ë—Ç 0:**
   - –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–µ–ª—ë–Ω–æ–π: ¬´üéÅ –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ¬ª
   - –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω—ã–º: –Ω–µ ¬´–û–ø–ª–∞—Ç–∏—Ç—å 0 USDT¬ª, –∞ ¬´–ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ¬ª

---

## –°–æ–æ–±—â–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ (`setPaymentStatus`)

### –¢–∏–ø—ã (`tone`):
- `'ok'` ‚Äî –∑–µ–ª—ë–Ω–∞—è —Ä–∞–º–∫–∞, —É—Å–ø–µ—Ö
- `'warn'` ‚Äî –∂—ë–ª—Ç–∞—è —Ä–∞–º–∫–∞, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- `'error'` ‚Äî –∫—Ä–∞—Å–Ω–∞—è —Ä–∞–º–∫–∞, –æ—à–∏–±–∫–∞
- `''` ‚Äî —Å–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç—É—Å

### –ü—Ä–∏–º–µ—Ä—ã:

```javascript
// –£—Å–ø–µ—Ö
setPaymentStatus('‚úÖ –ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –°–æ–∑–¥–∞—ë–º —Ç–≤–æ–π –∫–ª—é—á...', 'ok');

// –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
setPaymentStatus('‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã...', 'warn');

// –û—à–∏–±–∫–∞
setPaymentStatus('‚ùå –ü—Ä–æ–º–æ–∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω', 'error');

// –°–∫—Ä—ã—Ç—å
setPaymentStatus('', '');
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (free trial)
1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É ‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å
2. –û–∂–∏–¥–∞–µ–º–æ: `402 Payment Required`
3. –û–∫–Ω–æ –æ–ø–ª–∞—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí –≤–∏–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ ¬´üéÅ –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á¬ª
4. –ù–∞–∂–∞—Ç—å ‚Üí `loadingPage` (4 —Å–µ–∫) ‚Üí `successPage`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–º–æ–∫–æ–¥ –¥–∞—ë—Ç 0
1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É ‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å
2. –û–∂–∏–¥–∞–µ–º–æ: `402 Payment Required`
3. –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥ `FREE100` ‚Üí ¬´–ü—Ä–∏–º–µ–Ω–∏—Ç—å¬ª
4. –¶–µ–Ω–∞: ~~5.99~~ ‚Üí **0 USDT**
5. –ö–Ω–æ–ø–∫–∞: ¬´üéÅ –ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ¬ª (–∑–µ–ª—ë–Ω–∞—è)
6. –ù–∞–∂–∞—Ç—å ‚Üí `loadingPage` (4 —Å–µ–∫) ‚Üí `successPage`

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ–º–æ–∫–æ–¥ –¥–∞—ë—Ç —Å–∫–∏–¥–∫—É (>0)
1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É ‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å
2. –û–∂–∏–¥–∞–µ–º–æ: `402 Payment Required`
3. –í–≤–µ—Å—Ç–∏ –ø—Ä–æ–º–æ–∫–æ–¥ `DISCOUNT50` ‚Üí ¬´–ü—Ä–∏–º–µ–Ω–∏—Ç—å¬ª
4. –¶–µ–Ω–∞: ~~5.99~~ ‚Üí **2.99 USDT**
5. –ö–Ω–æ–ø–∫–∞: ¬´üí≥ –û–ø–ª–∞—Ç–∏—Ç—å 2.99 USDT¬ª (—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è)
6. –ù–∞–∂–∞—Ç—å ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è HOT Pay ‚Üí –æ–ø–ª–∞—Ç–∏—Ç—å ‚Üí ¬´–Ø —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª¬ª ‚Üí `loadingPage` ‚Üí `successPage`

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û–ø–ª–∞—Ç–∞ –±–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞
1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É ‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å
2. –û–∂–∏–¥–∞–µ–º–æ: `402 Payment Required`
3. –ù–µ –≤–≤–æ–¥–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥
4. –ö–Ω–æ–ø–∫–∞: ¬´üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ HOT Pay¬ª (—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è)
5. –ù–∞–∂–∞—Ç—å ‚Üí –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è HOT Pay ‚Üí –æ–ø–ª–∞—Ç–∏—Ç—å ‚Üí ¬´–Ø —É–∂–µ –æ–ø–ª–∞—Ç–∏–ª¬ª ‚Üí `loadingPage` ‚Üí `successPage`

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----|----------|
| `pendingPaymentRequestId` | `string \| null` | UUID –∑–∞—è–≤–∫–∏, –æ–∂–∏–¥–∞—é—â–µ–π –æ–ø–ª–∞—Ç—ã (–∏–∑ –æ—Ç–≤–µ—Ç–∞ 402) |
| `pendingPaymentSku` | `string \| null` | SKU —Ç–æ–≤–∞—Ä–∞ (–∏–∑ –æ—Ç–≤–µ—Ç–∞ 402 –∏–ª–∏ `getCurrentSku()`) |
| `activePromo` | `object \| null` | –ü—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥: `{ code, amount_after, discount_amount, currency }` |
| `freeTrialAvailable` | `boolean` | –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–µ—Ä–≤—ã–π –∫–ª—é—á (–∏–∑ `/api/pricing/catalog`) |
| `hasSubscriptionActive` | `boolean` | –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ (–∏–∑ `/api/pricing/catalog`) |
| `pricingCatalog` | `array` | –ö–∞—Ç–∞–ª–æ–≥ —Ü–µ–Ω (–∏–∑ `/api/pricing/catalog`) |

---

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. `POST /api/submit-request`
- **–¢–µ–ª–æ:** `{ mode, person1, person2?, transit?, request, language, initData }`
- **–û—Ç–≤–µ—Ç—ã:**
  - `200 OK` + `{ ok: true, requestId }` ‚Üí –±–µ—Å–ø–ª–∞—Ç–Ω–æ (gift/sub) ‚Üí `loadingPage`
  - `402 Payment Required` + `{ payment_required: true, requestId, sku }` ‚Üí –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã
  - `4xx/5xx` + `{ error }` ‚Üí alert

### 2. `POST /api/free-trial/claim`
- **–¢–µ–ª–æ:** `{ request_id, initData }`
- **–û—Ç–≤–µ—Ç—ã:**
  - `200 OK` + `{ ok: true }` ‚Üí `loadingPage` ‚Üí `successPage`
  - `4xx` + `{ error }` ‚Üí —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏

### 3. `POST /api/promos/validate`
- **–¢–µ–ª–æ:** `{ code, sku, initData }`
- **–û—Ç–≤–µ—Ç—ã:**
  - `200 OK` + `{ valid: true, amount_after, discount_amount, currency }` ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å UI
  - `4xx` + `{ error }` ‚Üí —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏

### 4. `POST /api/payments/hot/create`
- **–¢–µ–ª–æ:** `{ request_id, sku, promo_code?, initData }`
- **–û—Ç–≤–µ—Ç—ã:**
  - `200 OK` + `{ success: true, checkout_url }` ‚Üí –æ—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É
  - `200 OK` + `{ success: true, free_applied: true }` ‚Üí `loadingPage` ‚Üí `successPage`
  - `4xx` + `{ error }` ‚Üí —Å—Ç–∞—Ç—É—Å –æ—à–∏–±–∫–∏

### 5. `GET /api/payments/hot/status?request_id=...`
- **–û—Ç–≤–µ—Ç—ã:**
  - `200 OK` + `{ data: { payment_status: 'paid' } }` ‚Üí `loadingPage` ‚Üí `successPage`
  - `200 OK` + `{ data: { payment_status: 'pending' } }` ‚Üí –∂–¥–∞—Ç—å

### 6. `POST /api/payments/hot/confirm`
- **–¢–µ–ª–æ:** `{ request_id, initData }`
- **–û—Ç–≤–µ—Ç—ã:**
  - `200 OK` + `{ ok: true }` ‚Üí –∑–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

---

## Changelog

### 2026-02-18
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ —Å –ø—É—Å—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –ø–æ—Å–ª–µ `free_applied`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `console.log` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- ‚úÖ `activePromo` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –æ–∫–Ω–∞ –æ–ø–ª–∞—Ç—ã
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∫–ª—é—á" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `freeTrialAvailable`
- ‚úÖ –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –í—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã: `hidePaymentOverlay()` ‚Üí `goToPage('loadingPage')` ‚Üí `successPage`

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 2026-02-18  
**–í–µ—Ä—Å–∏—è:** 1.0
