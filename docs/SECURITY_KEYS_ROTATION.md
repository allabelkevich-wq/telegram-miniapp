# Ротация ключей и секретов (HOT + YupSoul)

## Что ротируем

- `HOT_WEBHOOK_SECRET`
- `HOT_API_JWT` (если используется)
- `SUPABASE_SERVICE_KEY`
- `BOT_TOKEN` (по необходимости/компрометации)
- `ADMIN_SECRET`

## Триггеры ротации

- Подозрение на компрометацию.
- Утечка в логи/репозиторий.
- Плановая ротация (рекомендуется раз в 60–90 дней для критичных ключей).

## Процедура (без простоя)

1. Подготовить новые секреты в защищённом хранилище.
2. Обновить секреты в окружении сервиса.
3. Для webhook:
   - сначала обновить секрет в HOT и в сервисе (в одном окне изменений),
   - проверить тестовым webhook.
4. Сделать redeploy.
5. Прогнать smoke-check:
   - create payment,
   - webhook signature validation,
   - status/confirm.
6. Отозвать старые ключи.

## Аварийная ротация (компрометация)

1. Немедленно отозвать скомпрометированный ключ.
2. Поставить новый ключ и redeploy.
3. Включить усиленный мониторинг webhook/оплат.
4. Проверить последние транзакции на аномалии (дубли, подмены).

## Хранение секретов

- Никогда не хранить в git.
- Не логировать значения секретов.
- Использовать env/secret manager платформы деплоя.
- Доступ к секретам — только ограниченному кругу админов.

