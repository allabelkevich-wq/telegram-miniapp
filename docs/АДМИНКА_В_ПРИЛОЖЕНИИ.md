# –ê–¥–º–∏–Ω–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞

## –¢–µ–∫—É—â–∞—è –≤–µ–±-–∞–¥–º–∏–Ω–∫–∞ (—É–∂–µ –µ—Å—Ç—å)

–ê–¥–º–∏–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å—Å—ã–ª–∫–µ —Å **–≤—Å–µ—Ö –Ω–∞—à–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤**:

| –û—Ç–∫—É–¥–∞ | –ö–∞–∫ –æ—Ç–∫—Ä—ã—Ç—å |
|--------|-------------|
| **–ë–æ—Ç (Telegram)** | –ö–æ–º–∞–Ω–¥–∞ `/admin` ‚Äî –±–æ—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–µ–±-–∞–¥–º–∏–Ω–∫—É. –ù–∞–∂–º–∏ –Ω–∞ —Å—Å—ã–ª–∫—É. |
| **Mini App** | –ù–∞ –≥–ª–∞–≤–Ω–æ–π —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `ADMIN_TELEGRAM_IDS` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ ¬´üëë –ê–¥–º–∏–Ω–∫–∞¬ª ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–µ–±-–∞–¥–º–∏–Ω–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ. |
| **–ì–ª–∞–≤–Ω–∞—è –±–æ—Ç–∞ (Render)** | –û—Ç–∫—Ä–æ–π –≤ –±—Ä–∞—É–∑–µ—Ä–µ `https://—Ç–≤–æ–π-—Å–µ—Ä–≤–∏—Å.onrender.com/` ‚Äî —Ç–∞–º —Å—Å—ã–ª–∫–∏ –Ω–∞ `/admin` –∏ `/admin-simple`. |
| **Health check** | –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/healthz` —Ç–æ–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É ¬´–ê–¥–º–∏–Ω–∫–∞¬ª –Ω–∞ `/admin-simple`. |

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π URL:** `https://—Ç–≤–æ–π-—Å–µ—Ä–≤–∏—Å.onrender.com/admin-simple` (–∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞—è–≤–æ–∫, —ç—Ç–∞–ø—ã, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫). –í—Ö–æ–¥: —Ç–æ–∫–µ–Ω –∏–∑ `ADMIN_SECRET` –≤ Render –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –∏–∑ Telegram (ID –≤ `ADMIN_TELEGRAM_IDS`).

---

## –ò–¥–µ—è (–¥–∞–ª—å–Ω–µ–π—à–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ)

- **–ë–æ—Ç** ‚Äî —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞: –æ—Ç–∫—Ä—ã—Ç–∏–µ Mini App, –ø—Ä–∏—ë–º –∑–∞—è–≤–æ–∫ (web_app_data + POST /api/submit-request), —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –∞–¥–º–∏–Ω–∞–º. –ö–æ–º–∞–Ω–¥—ã `/admin` –∏ `/admin_check` –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–ª–∏ —É–±—Ä–∞—Ç—å.
- **–ê–¥–º–∏–Ω–∫–∞** ‚Äî –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: –∞–¥–º–∏–Ω –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ –±–æ—Ç–∞ –∏ –≤–∏–¥–∏—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ ¬´–ê–¥–º–∏–Ω–∫–∞¬ª: —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –∏ **—Å—Ç–∞—Ç—É—Å –≤–æ—Ä–∫–µ—Ä–∞** (–ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫, —Å–∫–æ–ª—å–∫–æ –≤ –æ—á–µ—Ä–µ–¥–∏, –ø–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞).

## –ß—Ç–æ –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ

### 1. –í–æ—Ä–∫–µ—Ä –ø–∏—à–µ—Ç ¬´—Å–µ—Ä–¥—Ü–µ–±–∏–µ–Ω–∏–µ¬ª –≤ Supabase

–ß—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≤–æ—Ä–∫–µ—Ä –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–Ω –¥–æ–ª–∂–µ–Ω –∫—É–¥–∞-—Ç–æ –ø–∏—Å–∞—Ç—å —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å. –í–∞—Ä–∏–∞–Ω—Ç:

- –¢–∞–±–ª–∏—Ü–∞ **`worker_status`** –≤ Supabase (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç):
  - `updated_at` ‚Äî –∫–æ–≥–¥–∞ –≤–æ—Ä–∫–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –æ—Ç—á–∏—Ç–∞–ª—Å—è
  - `last_processed_id` ‚Äî id –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –∑–∞—è–≤–∫–∏ (–∏–ª–∏ `null`)
  - `last_error` ‚Äî —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏ (–∏–ª–∏ `null`)
  - `pending_count` ‚Äî —Å–∫–æ–ª—å–∫–æ –∑–∞—è–≤–æ–∫ –≤ —Å—Ç–∞—Ç—É—Å–µ pending (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í–æ—Ä–∫–µ—Ä (`worker-loop.js` / `workerGenerate.js`) –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏. –ü–æ `updated_at` –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å: ¬´–í–æ—Ä–∫–µ—Ä —Ä–∞–±–æ—Ç–∞–ª 2 –º–∏–Ω –Ω–∞–∑–∞–¥¬ª / ¬´–í–æ—Ä–∫–µ—Ä –Ω–µ –æ—Ç—á–∏—Ç—ã–≤–∞–ª—Å—è >10 –º–∏–Ω¬ª.

### 2. API –¥–ª—è –∞–¥–º–∏–Ω–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ –≤–∞–ª–∏–¥–Ω–æ–º—É `initData` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Ö–æ–¥–∏—Ç –≤ `ADMIN_TELEGRAM_IDS`:

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|----------|
| GET | `/api/admin/me` | –¢–µ–ª–æ: `initData` (–∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Telegram-Init`). –û—Ç–≤–µ—Ç: `{ admin: true/false, userId }` ‚Äî —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ –±–ª–æ–∫ ¬´–ê–¥–º–∏–Ω–∫–∞¬ª —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—É. |
| GET | `/api/admin/requests` | –¢–æ –∂–µ. –û—Ç–≤–µ—Ç: JSON —Å–æ —Å–ø–∏—Å–∫–æ–º –∑–∞—è–≤–æ–∫ (–∫–∞–∫ –≤ —Ç–µ–∫—É—â–µ–º `/admin`). |
| GET | `/api/admin/worker-status` | –¢–æ –∂–µ. –û—Ç–≤–µ—Ç: `{ updatedAt, lastProcessedId, lastError, pendingCount }` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `worker_status`. |

–í—Å–µ —Ç—Ä–∏ –º–∞—Ä—à—Ä—É—Ç–∞: –≤–∞–ª–∏–¥–∞—Ü–∏—è `initData` ‚Üí –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `telegram_user_id` ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ `ADMIN_IDS` ‚Üí –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–∞–≤ 403.

### 3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Mini App)

- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (–∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –≤ —Ä–∞–∑–¥–µ–ª ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏¬ª / ¬´–ï—â—ë¬ª): –∑–∞–ø—Ä–æ—Å `GET /api/admin/me` —Å —Ç–µ–∫—É—â–∏–º `initData` (–∏–∑ `Telegram.WebApp.initData`).
- –ï—Å–ª–∏ `admin === true` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—É–Ω–∫—Ç –º–µ–Ω—é/–∫–Ω–æ–ø–∫—É ¬´–ê–¥–º–∏–Ω–∫–∞¬ª.
- –í —ç–∫—Ä–∞–Ω–µ ¬´–ê–¥–º–∏–Ω–∫–∞¬ª:
  - –ó–∞–ø—Ä–æ—Å—ã `GET /api/admin/requests` –∏ `GET /api/admin/worker-status`.
  - –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ –∑–∞—è–≤–æ–∫ (–∫–∞–∫ —Å–µ–π—á–∞—Å –≤ –±–æ—Ç–µ) –∏ –±–ª–æ–∫–∞ ¬´–í–æ—Ä–∫–µ—Ä¬ª:
    - –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫: –ø–æ `updatedAt` (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´2 –º–∏–Ω –Ω–∞–∑–∞–¥¬ª);
    - –≤ –æ—á–µ—Ä–µ–¥–∏: `pendingCount`;
    - –ø–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: `lastError` (–µ—Å–ª–∏ –µ—Å—Ç—å).

–ë–æ—Ç —Ç–æ–≥–¥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π: –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–∏—ë–º –∑–∞—è–≤–æ–∫, –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–∞ –∏ —Å–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ ‚Äî –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### 4. –¢–∞–±–ª–∏—Ü–∞ `worker_status` –≤ Supabase

–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞, id=1):

```sql
create table if not exists worker_status (
  id int primary key default 1,
  updated_at timestamptz not null default now(),
  last_processed_id uuid references track_requests(id),
  last_error text,
  pending_count int
);

-- –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞
insert into worker_status (id, updated_at, last_error, pending_count)
values (1, now(), null, 0)
on conflict (id) do nothing;
```

–í–æ—Ä–∫–µ—Ä —Ä–∞–∑ –≤ —Ç–∏–∫ –¥–µ–ª–∞–µ—Ç `update worker_status set updated_at = now(), last_processed_id = ..., last_error = ..., pending_count = ... where id = 1`.

## –ò—Ç–æ–≥

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†–æ–ª—å |
|-----------|------|
| –ë–æ—Ç | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ¬ª, –ø—Ä–∏—ë–º –∑–∞—è–≤–æ–∫, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ü–æ –∂–µ–ª–∞–Ω–∏—é –æ—Å—Ç–∞–≤–∏—Ç—å `/admin` –∏ `/admin_check` –∫–∞–∫ –∑–∞–ø–∞—Å. |
| –í–æ—Ä–∫–µ—Ä | –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞—è–≤–∫–∏ + –ø–∏—à–µ—Ç —Å—Ç–∞—Ç—É—Å –≤ `worker_status`. |
| Backend | –£–∂–µ –µ—Å—Ç—å `validateInitData` –∏ `ADMIN_IDS`. –î–æ–±–∞–≤–∏—Ç—å GET `/api/admin/me`, `/api/admin/requests`, `/api/admin/worker-status`. |
| Mini App | –ü–æ `admin/me` –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ¬´–ê–¥–º–∏–Ω–∫–∞¬ª, –≤ –Ω–µ–π ‚Äî –∑–∞–ø—Ä–æ—Å—ã –∫ `admin/requests` –∏ `admin/worker-status`, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–æ—Ä–∫–µ—Ä–∞. |

–¢–∞–∫ –≤–æ—Ä–∫–µ—Ä –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∞–¥–º–∏–Ω—É –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –±–æ—Ç –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π.
