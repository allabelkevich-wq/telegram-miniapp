# Контекст для новой сессии / второго компьютера

Если открываешь проект в новом чате (или на другом компьютере), скопируй этот блок в первый сообщение ассистенту или напиши: «Прочитай docs/CONTEXT_FOR_NEW_SESSION.md и docs/BRIEF_FOR_QWEN.md».

---

## Что это за проект

**YupSoul** — Telegram Mini App + бот. Пользователь заполняет форму (имя, дата/место/время рождения, пол, запрос), переходит на страницу донатов (без фиксированной цены, реквизиты карт для перевода по желанию), нажимает «Отправить заявку» — данные уходят в бота через `sendData`. Заявки сохраняются в Supabase. Админ (Telegram ID в `bot/.env` → `ADMIN_TELEGRAM_IDS`) видит их по команде `/admin`. Терминология: «световой узор души», «звуковой ключ», «Твоя жизнь — игра»; слово «натальная карта» в интерфейсе не использовать.

---

## Что уже сделано

- **Mini App** (`index.html`): главная → форма с подтверждением даты и места (галочка «Подтверждаю место рождения») → страница донатов (Приорбанк и Альфа-банк реквизиты) → кнопка «Отправить заявку» → в Telegram вызывается MainButton и `sendData`, приложение закрывается.
- **Бот** (`bot/`): grammY, `/start`, приём `web_app_data`, сохранение в Supabase (таблица `track_requests`) и в память, `/admin` для списка заявок. При старте выставляется Menu Button на Mini App. Секреты в `bot/.env` (BOT_TOKEN, ADMIN_TELEGRAM_IDS, SUPABASE_URL, SUPABASE_SERVICE_KEY).
- **Документация**: `ССЫЛКА_ДЛЯ_КНОПКИ_БОТА.txt`, `docs/ПОЛНАЯ_ИНСТРУКЦИЯ_ДЛЯ_ЗАПУСКА.md`, `bot/НАСТРОЙКА_АДМИНА.md`, `docs/ASTRO_AUTOMATION.md`, `docs/BRIEF_FOR_QWEN.md`. Локальный превью: в корне `npm run preview` (live-server).

---

## О чём договаривались в переписке

- Режим донатов вместо фиксированной цены; реквизиты двух карт встроены в страницу.
- Ссылка на приложение иногда слетает в BotFather — бот при старте ставит кнопку меню сам; запасной вариант — вручную вставить ссылку из `ССЫЛКА_ДЛЯ_КНОПКИ_БОТА.txt`.
- Заявки и /admin: таблица `track_requests` в Supabase, при ошибке базы в консоли и админу показывается подсказка. Тестовая заявка через приложение → потом /admin.
- Превью локально и в Telegram не синхронизированы (локально — из папки, в TG — с GitHub Pages); финальную проверку делаем в Telegram после пуша.
- Планировалась пересборка/дизайн в Qwen — бриф в `docs/BRIEF_FOR_QWEN.md`; встраивание дизайна от Qwen в наш код — по запросу, когда будет код от Qwen.
- **Тариф «Мастер» и модуль «Мои герои»:** полное ТЗ в `docs/SPEC_MOI_GEROI_MASTER.md`. Миграция БД: `bot/supabase-migration-master-heroes.sql` (app_users, clients, track_requests.client_id). Реализация UI — по чек-листу в спеке.
- **Главный промпт проекта** — **«Идеально отлаженный системный промт»**. В коде: `bot/promptTemplates.js` (MAIN_PROMPT_NAME = `ideally_tuned_system_v1`). Полный текст: `docs/IDEALLY_TUNED_PROMPT.md`. Шаблон с переменными: `bot/prompts/ideally_tuned_system.txt`. В БД загружается через `npm run seed-ideally-tuned` в папке `bot/`. Подробнее: `docs/PROMPTS_ENCYCLOPEDIA.md`.

---

## На втором компьютере

После клонирования репо создать вручную `bot/.env` (токены в репозиторий не коммитятся). Остальной контекст — в этом файле и в `docs/BRIEF_FOR_QWEN.md` и `PROJECT_BRIEF.md`.
